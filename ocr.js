const fs = require('fs')
const PNG = require('pngjs').PNG

let pngName = './sample.png'

fs.createReadStream(pngName)
  .pipe(new PNG({
    colorType: 2 // 2 = rgb  6 = rgba
  }))
  .on('parsed', function () {
    let _res = []

    /**
     * 识别区域
     * 宽： 1890 每行 189 个字符
     * 高： 1046 共   48行文字
     *
     * 起始 坐标  x = 12 y = 27   结束  x = 1901, y = 1072
     *
     * 字符 高 12px 宽 10px
     */

    let skip = 0
    for (var y = 27; y <= 1072; y++) {

      if(skip > 0 && (skip % 12 == 0)) {
        y += 10
      }

      if(y > 1072){
        break
      }

      for (var x = 12; x <= 1901; x++) {
        var idx = (this.width * y + x) << 2;
        _res.push(getColor(this.data[idx], this.data[idx + 1], this.data[idx + 2]))
      }

      skip++
    }

    let mm = splitArray(_res, 1890)
    mm.forEach(item => {
      let lineStr = item.join('')
      console.log(lineStr)
    })
  })

function getColor(r, g, b) {
  let res = (g > 60) ? 1 : 0
  return res
}

// 将一维数组分割为二维数组
function splitArray(src, length) {
  let dest = []
  for (let i = 0, len = src.length; i < len; i += length) {
    dest.push(src.slice(i, i + length))
  }
  return dest
}

let ocrdb = {
  '0':'110000111110011101111011110011001111001101111000110111011011011011101100011110110011111011101111001110011101111100001111',
  '1':'111001111110010111111111011111111101111111110111111111011111111101111111110111111111011111111101111111110111111000000011',
  '2':'110000111110111001111111110111111111001111111101111111100111111110011111110011111110011111110011111110011111111000000011',
  '3':'100000111111111001111111110111111111011111111011111100001111111111011111111100111111110011111111011111111001111000001111',
  '4':'111110011111110001111110000111111011011111011101111001110111101111011101111101110000000000111111011111111101111111110111',
  '5':'100000011110111111111011111111101111111110111111111000001111111110011111111100111111110011111111011111111001111000001111',
  '6':'111000011111001111111011111111101111111110111111110010000111001111001100111110111011111011101111101110011101111100001111',
  '7':'000000001111111110111111110111111111011111111001111111101111111100111111110111111110011111111011111111001111111101111111',
  '8':'110000111110111101111011110011101111001110111101111001100111111000111110011001110011110011001111001110111100111100000111',
  '9':'110000111110111101110011110111011111001101111110111011110011110000001111111110111111110111111111011111110011111000011111',
  'A':'111000111111100011111111101111110110011111011101111101110111101111011110111100111000000011011111101101111111010111111101',
  'B':'100000111110111101111011110111101111011110111001111000001111101111011110111100111011111011101111101110111101111000001111',
  'C':'111000011111011111111011111111001111111100111111110011111111001111111100111111110011111111101111111110011111111110000111',
  'D':'000000111101111001110111110011011111101101111110110111111011011111101101111110110111111011011111001101111001110000011111',
  'E':'100000001110111111111011111111101111111110111111111000000011101111111110111111111011111111101111111110111111111000000011',
  'F':'100000001110111111111011111111101111111110111111111011111111100000011110111111111011111111101111111110111111111011111111',

}